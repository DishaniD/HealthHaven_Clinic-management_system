{% extends 'main2.html' %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html>
    
<head>
  <title>Login</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" 
  integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" 
		rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" 
		crossorigin="anonymous">

  <style>
		.gradient-custom-2 {
	  /* fallback for old browsers */
	  background: #fccb90;

	  /* Chrome 10-25, Safari 5.1-6 */
	  background: -webkit-linear-gradient(to right, #ee7724, #d8363a, #dd3675, #b44593);

	  /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
	  background: linear-gradient(to right, #ee7724, #d8363a, #dd3675, #b44593);
	}

	@media (min-width: 768px) {
	  .gradient-form {
		height: 100vh !important;
	  }
	}
	@media (min-width: 769px) {
	  .gradient-custom-2 {
		border-top-right-radius: .3rem;
		border-bottom-right-radius: .3rem;
	  }
	}

	#id_username, #id_password1, #id_password2{
	display: block;
	width: 200px;
	padding: .375rem .75rem;
	font-size: 1rem;
	font-weight: 400;
	line-height: 1.5;
	color: #212529;
	background-color: #fff;
	background-clip: padding-box;
	border: 1px solid #ced4da;
	-webkit-appearance: none;
	-moz-appearance: none;
	appearance: none;
	border-radius: .25rem;
	transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
	
	}


  </style>

</head>
<body >
	<section class="" style="background-color: #deee; margin-top: 90px;">
	  <div class="container py-3 h-100">
		<div class="row d-flex justify-content-center align-items-center h-100 ">
		  <div class="d-flex justify-content-center ">
			<div class="card rounded text-black border border-info" style=" width: 740px;">
			  <div class="row g-0 " style ="background-color:#c0c6c9;">
				
				  <div class="card-body p-md-3 mx-md-2">

					<div class="text-center">
					  <img src="https://mdbootstrap.com/img/Photos/new-templates/bootstrap-login-form/lotus.png" style="width: 185px;" alt="logo">
					  <h4 class="mt-1 mb-3 pb-1">Please Sign-Up</h4>
					</div>

					<form method="POST" class="form-row">					  
					  {% csrf_token %}

                <div class="row d-flex justify-content-center align-items-center "  id="success-alert" >
                    {% if messages %}

                        {% for message in messages %}
                        <div class="alert {{ message.tags }}" role="alert" id="msg"  style="width: 250px; height:40px; text-align: center; font-style: italic; padding-top: 7px;  margin-left: 60px; border-radius: 5px; font-weight: bolder;">
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true"></span>
                            </button>
                            {{ message }}
                        </div>

                        {% endfor %}
                    {% endif %}

                </div>
  
             {% for field in userform %}
               <div class="col-md-4 pl-4 ml-2 mb-3" >
                  <label  class="form-label fw-bold" for="{{field.auto_id}}">
                      {{field.label}}
                      {% if field.field.required %} <span style="color:red;">*</span>{% endif %}

                  </label>        
                  <div class="" title="{{field.help_text}}" > 
                       {{field}}
                       {{field.errors}}
                  </div>                              
              </div>
              {% endfor %}

                {% for field in form %}
                 <div class="col-md-6 pb-3 g-2  pl-4" >
                    <label  class=" form-label fw-bold" for="{{field.auto_id}}">
                        {{field.label}}
                        {% if field.field.required %} <span style="color:red;">*</span>{% endif %}

                    </label>        
                    <div class="col-sm-11 " > 
                         {{field}}
                         {{field.help_text}}
                         {{field.errors}}
                    </div>                              
                </div>
                {% endfor %}              

					  <div class="text-center pt-1 mb-3 pb-1 " style=" margin-left:220px;">
						<input class="btn btn-primary  fa-lg gradient-custom-2 mb-3 " type="submit" name="Create user" style="width:250px; ">
						<p class="text-muted ml-4" href="#!">Thank you for Register with Us</p>
					  </div>

					</form>

				  </div>
				
				
			  </div>
			</div>
		  </div>
		</div>
	  </div>
	</section>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script >
	
/* Allergyy select  */
$(document).ready(function() {
    $('#id_allergies').select2({
        width: '100%' 
    });
});

/* Message script */

$("#msg").fadeTo(2000, 500).slideUp(500, function(){
    $("#smsg").slideUp(500);
});




/*Nic validation*/


var d_array = [
    { month: 'January', days: 31 },
    { month: 'February', days: 29 },
    { month: 'March', days: 31 },
    { month: 'April', days: 30 },
    { month: 'May', days: 31 },
    { month: 'June', days: 30 },
    { month: 'July', days: 31 },
    { month: 'August', days: 31 },
    { month: 'Septhember', days: 30 },
    { month: 'October', days: 31 },
    { month: 'November', days: 30 },
    { month: 'December', days: 31 },
];




$('#id_dob').click(function() {
    $('.nic-validate-error').html('');
    $('.nic-birthday').html('');
    $('.nic-gender').html('');
    var nicNumber = $('.nic-validate').val();
    if (validation(nicNumber)) {
        console.log(nicNumber);
        var extracttedData = extractData(nicNumber);
        var days = extracttedData.dayList;
        var findedData = findDayANDGender(days, d_array);

        var month = findedData.month;
        var year = extracttedData.year;
        var day = findedData.day;
        var gender = findedData.gender;
        var bday = day + '-' + month + '-' + year;
        var birthday = new Date(bday.replace(/(\d{2})-(\d{2})-(\d{4})/, "$2/$1/$3"));
        var birthday = getFormattedDate(birthday);
        $('#id_dob').val(birthday);
        $('#id_gender').val(gender);

    } else {
        alert("Oh ! Please enter correct NIC.");
    }
});


function findDayANDGender(days, d_array) {
    var dayList = days;
    var month = '';
    var result = { day: '', month: '', gender: '' };


    if (dayList < 500) {
        result.gender = 'Male';
    } else {
        result.gender = 'Female';
        dayList = dayList - 500;
    }

    for (var i = 0; i < d_array.length; i++) {
        if (d_array[i]['days'] < dayList) {
            dayList = dayList - d_array[i]['days'];
        } else {
            month = d_array[i]['month'];
            break;
        }
    }
    result.day = dayList;
    result.month = month;
    return result;
}

function extractData(nicNumber) {
    var nicNumber = nicNumber;
    var result = { year: '', dayList: '', character: '' };

    if (nicNumber.length === 10) {
        result.year = nicNumber.substr(0, 2);
        result.dayList = nicNumber.substr(2, 3);
        result.character = nicNumber.substr(9, 10);
    } else if (nicNumber.length === 12) {
        result.year = nicNumber.substr(0, 4);
        result.dayList = nicNumber.substr(4, 3);
        result.character = 'no';
    }
    return result;
}


function validation(nicNumber) {
    var result = false;
    if (nicNumber.length === 10 && !isNaN(nicNumber.substr(0, 9)) && isNaN(nicNumber.substr(9, 1).toLowerCase()) && ['x', 'v'].includes(nicNumber.substr(9, 1).toLowerCase())) {
        result = true;
    } else if (nicNumber.length === 12 && !isNaN(nicNumber)) {
        result = true;
    } else {
        result = false;
    }
    return result;
}

function getFormattedDate(date) {
    var year = date.getFullYear();

    var month = (1 + date.getMonth()).toString();
    month = month.length > 1 ? month : '0' + month;

    var day = date.getDate().toString();
    day = day.length > 1 ? day : '0' + day;

    return month + '/' + day + '/' + year;
}


/*  Age Calculate*/


$('#id_dob').click(function ageCalculator() {
    var userinput = document.getElementById("id_dob").value;
    var dob = new Date(userinput);
    if(userinput==null || userinput=='') {
      document.getElementById("message").innerHTML = "**Choose a date please!";    
      return false; 
    } else {
    
    //calculate month difference from current date in time
    var month_diff = Date.now() - dob.getTime();
    
    //convert the calculated difference in date format
    var age_dt = new Date(month_diff); 
    
    //extract year from date    
    var year = age_dt.getUTCFullYear();
    
    //now calculate the age of the user
    var age = Math.abs(year - 1970);
    
    //display the calculated age
      $('#id_age').val(age);
    }
});





</script>

</body>

</html>
{% endblock %}