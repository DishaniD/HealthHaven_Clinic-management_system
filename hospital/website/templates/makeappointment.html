{% extends 'main2.html' %}
{% block content %}
{% load static %}

<div class="row ">
<div class="col-md-2"></div>
<div class="col-md-8 " style="border: 1px solid  #4166f5; margin-top: 120px; border-radius: 3px; margin-bottom: 20px;">
    <div class="row text-left" style=" padding-top:10px; padding-left: 40px; padding-right: 40px">
        <h3 class="font-weight-bold">Appointment Form</h3>
    </div>
    <hr/>
 
      

    {{p_details}}
    
    
    <form id="customerrequestform" onsubmit="return false;">

        <div class="container-fluid" style="border-radius: 10px; margin-top: 20px;">
            <div class="text-right">
                <b><span style="color: red; font-size:24px;">*</span> Required Field</b>
            </div>
                
            <div class="form-row" style="padding-left: 40px; padding-right: 40px">
                <div class="form-group col-md-6">
                    <label class="col-form-label" for="txtEmail"><b>Clinic Name
                        <span style="color:red; font-size:24px;">*</span></b></label>
                    <div class="input-group">
                        <select class="form-control js-example-basic-single"
                                required data-toggle="tooltip"
                                data-placement="bottom"
                                title="Select the Clinic"                        
                                id="cmbClinics">
                          <option  selected disabled style="width: 85%">Select One</option>

                          {% for clinic in clinics %}
                          <option value="{{ clinic.id }}">{{ clinic.name }}</option>
                          {% endfor %}
                        </select>

                        <span class="input-group-append">
                            <button class="btn border-right-1 border-primary" type="button"
                                    style="width: 40px">
                                <i class="fa fa-envelope"></i>
                            </button>
                        </span>
                    </div>
                </div>
                <div class="form-group col-md-6">
                    <label class="col-form-label" for="txtEmail"><b>Doctor Name
                        <span style="color:red; font-size:24px;">*</span></b></label>
                    <div class="input-group">
                        <select id="cmbDoctorName" class="form-control js-example-basic-single"
                                required data-toggle="tooltip"
                                data-placement="bottom"
                                title="Select Doctor" style="width: 85%" disabled>
                          <option  selected disabled style="width: 85%">Select One</option>

                          {% for clinicDate in clinicDates %}
                          <option value="{{ clinicDate.id }}" >{{ clinicDate.doctor }}</option>
                          {% endfor %}

                        </select>

                        <span class="input-group-append">
                            <button class="btn border-right-1 border-primary" type="button"
                                    style="width: 40px">
                                <i class="fa fa-envelope"></i>
                            </button>
                        </span>
                    </div>
                </div>

            </div>

            <div class="form-row" style="padding-left: 40px; padding-right: 40px">
                <div class="form-group col-md-6">
                    <label class="col-form-label" for="cmbTourPack"><b>Clinic Date
                        <span style="color: red; font-size:24px;">*</span></b></label>
                    <div class="input-group">
                        <select class="form-control" id="id_ClinicDate" required disabled>
                          <option  selected disabled style="width: 85%">Select One</option>
                          {% for clinicDate in clinicDates %}
                          <option value="{{clinicDate.id}}" >{{clinicDate.start_time}}</option>
                          {% endfor %}

                        </select>
                        <span class="input-group-append">
                             <button class="btn border-right-1 border-primary"  type="button" style="width: 40px">
                                <i class="fa fa-suitcase"></i>
                             </button>
                        </span>
                    </div>

                </div>

                <div class="form-group col-md-6">
                    <label class="col-form-label" for="cmbTourPack"><b>Appointment Number
                        <span style="color: red; font-size:24px;">*</span></b></label>
                    <div class="input-group">
                    <input class="form-control col-md-12 " type="text" id="txtnumber" placeholder="Appointment Number"
                               data-toggle="tooltip" data-placement="bottom"
                               title="Appointment Number" required disabled >
                        <span class="input-group-append">
                             <button class="btn border-right-1 border-primary"  type="button" style="width: 40px">
                                <i class="fa fa-suitcase"></i>
                             </button>
                        </span>

                    </div>

                </div>

            </div>

            <hr/>
            {% for d in p_details %}
            <div class="form-row" style="padding-left: 40px; padding-right: 40px">
                <div class="form-group col-md-6">
                    <label class="col-form-label" for="txtCustomerName"><b>First Name
                        <span style="color: red; font-size:24px;">*</span></b></label>
                    <div class="input-group">
                        <input class="form-control" type="text" id="txtPatientName"
                               placeholder="Enter First Name Here " required value="{{d.first_name}}" />
                        <span class="input-group-append">
                             <button class="btn border-right-1 border-primary"
                                     type="button" style="width: 40px">
                               <i class="fa fa-user"></i>
                             </button>
                        </span>
                    </div>
                </div>
                <div class="form-group col-md-6">
                    <label class="col-form-label" for="txtCustomerName"><b>Middle Name
                        <span style="color: red; font-size:24px;">*</span></b></label>
                    <div class="input-group">
                        <input class="form-control" type="text" id="txtPatientName"
                               placeholder="Enter Middle Name Here " required  value="{{d.second_name}}"/>
                        <span class="input-group-append">
                             <button class="btn border-right-1 border-primary"
                                     type="button" style="width: 40px">
                               <i class="fa fa-user"></i>
                             </button>
                        </span>
                    </div>
                </div>
            
            </div>

            <div class="form-row" style="padding-left: 40px; padding-right: 40px">
                <div class="form-group col-md-6">
                    <label class="col-form-label" for="cmbCustomerRegion"><b>NIC
                        <span style="color: red; font-size:24px;">*</span></b></label>
                    <div class="input-group">
                        <input class="form-control" type="email" id="txtEmail"
                               data-toggle="popover"
                               data-content="example@gmail.com" data-placement="bottom"
                               placeholder="Enter Email Here " value="{{d.nic}}"/>
                        <span class="input-group-append">
                             <button class="btn border-right-1 border-primary"  type="button" style="width: 40px">
                                <i class="fa fa-globe"></i>
                             </button>
                        </span>
                    </div>
                </div>
                <div class="form-group col-md-6">
                    <label class="col-form-label" for="txtMobile"><b>Patient
                        Mobile-Number <span style="color: red; font-size:24px;">*</span></b></label>
                    <div class="input-group">
                        <input class="form-control col-12 " type="text" id="txtMobile"
                               placeholder="Enter Mobile Here " 
                               required value="{{d.mobile1}}" />
                        <span class="input-group-append">
                            <button class="btn border-right-1 border-primary" type="button"
                                    style="width:40px">
                                <i class="fa fa-phone"></i>
                            </button>
                        </span>
                    </div>
                </div>

            </div>

            <div class="form-row" style="padding-left: 40px; padding-right: 40px">
                <div class="form-group col-md-6">
                    <label class="col-form-label" for="dteDORequired"><b>Date Of Birth<span style=" font-size:24px;"></span>
                    </b></label>
                    <div class="input-group">
                        <input class="form-control"  id="dteDORequired" value="{{d.dob}}"/>
                        <span class="input-group-append" >
                            <button class="btn border-right-1 border-primary" type="button"  style="width: 40px">
                                <i class="fa fa-calendar"></i>
                            </button>
                        </span>
                    </div>
                </div>

                <div class="form-group col-md-6">
                    <label class="col-form-label" for="txtMobile" style="padding-top: 20px;"><b>Patient
                        Mobile-Number 2 
                    </label>
                    <div class="input-group">
                        <input class="form-control col-12 " type="text" id="txtMobile"
                               placeholder="Enter Mobile Here "/>
                        <span class="input-group-append">
                            <button class="btn border-right-1 border-primary" type="button"
                                    style="width:40px">
                                <i class="fa fa-phone"></i>
                            </button>
                        </span>
                    </div>
                </div>
            </div>

            <div class="form-row" style="padding-left: 40px; padding-right: 40px">
                <div class="form-group col-md-12">

                    <label class="col-form-label" for="txtComment"><b>Address<span
                            style="color: red; font-size:24px;"></span></b></label>
                    <div class="input-group">
                        <input  class="form-control" id="txtComment"
                                  data-toggle="popover"
                                  data-content="Write your comments here" data-placement="bottom"
                                  placeholder="Enter Comments Here" value="{{d.address}}"/>
                        <span class="input-group-append">
                            <button class="btn border-right-1 border-primary" type="button"
                                    style="width: 40px">
                                <i class="fa fa-info"></i>
                            </button>
                        </span>
                    </div>
                </div>
                <div class="form-group col-md-12">
                    <p style="color: black; font-size: small;">Note : When your appointment recived us we will contact you.</p>
                </div>

            </div>

        </div>

        <div class="container-fluid" style="padding-left: 40px; padding-right: 55px; padding-top: 10px;">
            <div class="text-right">
                <div class="form-group">
                    <button id="btnAdd" class="btn btn-outline-success ml-2" type="submit"
                            style="width: 15%;"><i class="fa fa-envelope"></i> Send
                    </button>
                </div>
            </div>
        </div>

    </form>
</div>
</div>

{% endfor %}

<script type="text/javascript">
    

$('#cmbClinics').change(function(){

  /*alert("hello");*/

  var combo = document.getElementById('cmbClinics');
  var clinic_id = combo.value;

  $.ajax({
    url:'/api/clinic/' + clinic_id,
    
 
    success:function(data){
       /*console.log(data);*/
       var designation = parseInt(data.designation);



        $.ajax({
            url:'../api/designation_employees/',
            data:{
              'designation_id':designation

            },
            
            success:function(data){
               /*console.log(data);*/
               
               var cmbDoctor =  document.getElementById('cmbDoctorName');
               cmbDoctor.disabled = false;
               cmbDoctor.innerHTML = '<option disabled selected >your doctor</option>';
               data.forEach(function(doctor){
                var option = document.createElement('option');
                option.value = doctor.user__id;
                option.innerHTML = doctor.user__username;
                /*console.log(option);*/
                cmbDoctor.appendChild(option);
              
              });

            }

        });

    }

  });

});

/*Clinic dates load*/

$('#cmbDoctorName').change(function(){

 /* alert("hello");
*/
  var combo = document.getElementById('cmbDoctorName');
  var doctor_id = combo.value;

  $.ajax({
    url:'../api/doctor_clinic_date',
    data:{
      'doctor_id':doctor_id

    },
    success:function(data){
      var cmbClinicDate =  document.getElementById('id_ClinicDate');
      cmbClinicDate.disabled = false;
      cmbClinicDate.innerHTML = '<option disabled selected >select date</option>';
      data.forEach(function(clinic_date){
        var option = document.createElement('option');
        option.value = clinic_date.id;
        option.innerHTML = clinic_date.start_time;
        /*console.log(option);*/
        cmbClinicDate.appendChild(option);
      
      
      });
    }

  });

});

/*Appointment number load*/

$('#id_ClinicDate').change(function(){

  /*alert("hello");*/

  var combo = document.getElementById('id_ClinicDate');
  var clinic_date_id = combo.value;

  $.ajax({
    url:'../api/clinic_date_details/' + clinic_date_id,
    
    success:function(data){
      var textappoinmentnumber =  document.getElementById('txtnumber');
      var occupied = parseInt(data.occupied);
      var capacity = parseInt(data.capacity);

      if(occupied < capacity){ 
        textappoinmentnumber.value = parseInt(data.occupied) + 1;
      }

      else {
        alert("capacity full");
        combo.selectedIndex = 0;
      }
    
      /*console.log(parseInt(data.occupied) + 1);*/
    }


  });


});



</script>







































{% endblock %}